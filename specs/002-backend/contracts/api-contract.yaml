# API Contract: Task Management API

## Base Path
`/api/{user_id}/tasks`

## Authentication
All endpoints require a valid JWT token in the Authorization header:
```
Authorization: Bearer <jwt_token>
```

## Common Response Codes
- `200 OK` - Request successful
- `201 Created` - Resource created successfully
- `400 Bad Request` - Invalid request data
- `401 Unauthorized` - Invalid or missing JWT token
- `403 Forbidden` - User not authorized to access resource
- `404 Not Found` - Resource does not exist
- `422 Unprocessable Entity` - Request validation failed

## Endpoints

### GET /api/{user_id}/tasks
**Description**: List all tasks for the specified user

**Path Parameters**:
- `user_id` (string, required): User identifier from JWT token

**Query Parameters**:
- `status` (string, optional): Filter by completion status ("completed", "pending")
- `sort` (string, optional): Sort order ("created_asc", "created_desc", "updated_asc", "updated_desc")

**Response**:
```json
{
  "tasks": [
    {
      "id": 1,
      "title": "Sample task",
      "description": "Sample description",
      "completed": false,
      "user_id": "user123",
      "created_at": "2023-01-01T00:00:00Z",
      "updated_at": "2023-01-01T00:00:00Z"
    }
  ]
}
```

### POST /api/{user_id}/tasks
**Description**: Create a new task for the specified user

**Path Parameters**:
- `user_id` (string, required): User identifier from JWT token

**Request Body**:
```json
{
  "title": "Task title",
  "description": "Task description"
}
```

**Response**:
```json
{
  "id": 1,
  "title": "Task title",
  "description": "Task description",
  "completed": false,
  "user_id": "user123",
  "created_at": "2023-01-01T00:00:00Z",
  "updated_at": "2023-01-01T00:00:00Z"
}
```

### GET /api/{user_id}/tasks/{id}
**Description**: Get a specific task for the specified user

**Path Parameters**:
- `user_id` (string, required): User identifier from JWT token
- `id` (integer, required): Task identifier

**Response**:
```json
{
  "id": 1,
  "title": "Task title",
  "description": "Task description",
  "completed": false,
  "user_id": "user123",
  "created_at": "2023-01-01T00:00:00Z",
  "updated_at": "2023-01-01T00:00:00Z"
}
```

### PUT /api/{user_id}/tasks/{id}
**Description**: Update a specific task for the specified user

**Path Parameters**:
- `user_id` (string, required): User identifier from JWT token
- `id` (integer, required): Task identifier

**Request Body**:
```json
{
  "title": "Updated task title",
  "description": "Updated task description",
  "completed": true
}
```

**Response**:
```json
{
  "id": 1,
  "title": "Updated task title",
  "description": "Updated task description",
  "completed": true,
  "user_id": "user123",
  "created_at": "2023-01-01T00:00:00Z",
  "updated_at": "2023-01-02T00:00:00Z"
}
```

### DELETE /api/{user_id}/tasks/{id}
**Description**: Delete a specific task for the specified user

**Path Parameters**:
- `user_id` (string, required): User identifier from JWT token
- `id` (integer, required): Task identifier

**Response**: No content (204)

### PATCH /api/{user_id}/tasks/{id}/complete
**Description**: Toggle the completion status of a specific task for the specified user

**Path Parameters**:
- `user_id` (string, required): User identifier from JWT token
- `id` (integer, required): Task identifier

**Response**:
```json
{
  "id": 1,
  "title": "Task title",
  "description": "Task description",
  "completed": true,
  "user_id": "user123",
  "created_at": "2023-01-01T00:00:00Z",
  "updated_at": "2023-01-02T00:00:00Z"
}
```

## Security Requirements
1. JWT token must be valid and not expired
2. user_id in URL path must match user_id in JWT token payload
3. User can only access, modify, or delete their own tasks
4. Database queries must filter by user_id to prevent data leakage